#!/usr/bin/env ruby
require_relative("../lib/player")
require_relative("../lib/board")
require_relative("../lib/logic")

class Game
  include Logic
  #@@arr =[1,2,3,4,5,6,7,8,9]
  def initialize
    @player1_trn = []
    @player2_trn = []
    @winning_options = [[1, 2, 3], [4, 5, 6], [7, 8, 9], [1, 4, 7], [2, 5, 8], [3, 6, 9], [1, 5, 9], [3, 5, 7]]
    @turns = []
  end

  def greeting
    puts "Welcome to Ruby's tic tac toe \u{1F600}"
    puts

    puts "Enter first player name:"
    @player1 = gets.chomp.capitalize

    until Board.validate_name(@player1)
      puts "Name is too short, please try again"
      @player1 = gets.chomp.capitalize
    end

    puts "Enter second player name:"
    @player2 = gets.chomp.capitalize

    until Board.validate_name(@player2)
      puts "Name is too short,please try again"
      @player2 = gets.chomp.capitalize
    end

    @star = "\u{2B50}"
    @droplet = "\u{1F4A7}"

    @first_player = Player.new(@player1, @star)
    @second_player = Player.new(@player2, @droplet)

    puts
    puts "#{@first_player.name} will play with #{@first_player.sign}
and #{@second_player.name} will play with #{@second_player.sign}"
    puts
    puts "Let's Start!"
    puts
  end

  def board
    @arr = [1, 2, 3, 4, 5, 6, 7, 8, 9]
    puts "+---+---+---+"
    puts "| #{@arr[0]} | #{@arr[1]} | #{@arr[2]} |"
    puts "+---+---+---+"
    puts "| #{@arr[3]} | #{@arr[4]} | #{@arr[5]} |"
    puts "+---+---+---+"
    puts "| #{@arr[6]} | #{@arr[7]} | #{@arr[8]} |"
    puts "+---+---+---+"
    puts
  end

  def draw
    puts "#{@fisrt_player.name} & #{@second_player.name} Draw"
  end

  def player1_wins
    puts "The Winner is #{@fisrt_player.name} \u{1f973} \u{1F389}"
    puts "Good luck next time #{@second_player.name} \u{1f609}"
  end

  def player2_wins
    puts "The Winner is #{@second_player.name} \u{1f973} \u{1F389}"
    puts "Good luck next time #{@first_player.name} \u{1f609}"
  end
  
  def player1_turn
    puts "It is #{@first_player.name}'s turn"
    puts 
    puts "Please select an available cell number"
    board
    loop do
      player1_turn = gets.chomp
      @player1_trn << player1_turn.to_i if test_move(player1_turn) == true
      puts 'Invalid move! Please pick a number between 1 & 9:' if test_move(player1_turn) == false
      break if test_move(player1_turn) == true
    end
  end

  def player2_turn
    puts " Now It is #{@second_player.name}'s turn"
    puts 
    puts "Please select an available cell number"
    board
    loop do
      player2_turn = gets.chomp
      @player2_trn << player2_turn.to_i if test_move(player2_turn) == true
      puts 'Invalid move! Please pick a number between 1 & 9:' if test_move(player2_turn) == false
      break if test_move(player2_turn) == true
    end
  end

  def winner
    puts "Invalid move, please enter a number from 1 to 9"
    puts "It's a TIE"
    puts
    puts "Game over"
    puts
    puts
  end
end

game = Game.new
game.greeting
game.board
game.player1_turn
game.player1_turn

game.winner
